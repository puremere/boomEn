
@using banimo.ViewModel;
@model banimo.ViewModel.TimeList
@{
    /**/

    ViewBag.Title = Resources.res.endOrder;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/languageStyle.css" rel="stylesheet" />
<link href="~/Extra/leaflet/leaflet.css" rel="stylesheet" />

@section scripts{

    <link href="~/Content/endOrderStyle.css" rel="stylesheet" />



    <script>

        function addCommas(nStr) {
            nStr += '';
            var x = nStr.split('.');
            var x1 = x[0];
            var x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }
    </script>
    <script>
        $(document).ready(function () {
            $(".master").click(function () {

                $(".dispath").css("display", "none");
                var i = $(this).children();
                i.css("display", "block");

                var id = i.attr("id");

                $(".slave").css("display", "none");
                $("#" + id).css("display", "block");
                $("#" + id).children().children().first().css("display", "block");
                $("#hourid").val($("#" + id).children().children().first().attr("id"));


            })
            $(".slave .halfrow").click(function () {
                $(".finalrow").css("display", "none");
                var i = $(this).children();
                i.css("display", "block");
                var id = i.attr("id");
                $("#hourid").val(id);
            })
        })
    </script>
    <script>
        $("#mellat").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("3");
        })
        $("#pasargad").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("4");
        })

        $("#internet").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("5");
        })
        $("#inplace").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("2");
        })

        $("#Wallet").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("1");
        })
    </script>

    <script>

        $(".panel").css("display", "block");
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }
    </script>
    <script>
        let value = "0";
        $("#lableToggle input").click(function () {


            if ($(this).is(':checked')) {
                $("#raveshpardakht").css("display", "none");

                value = "1"
            }
            else {
                $("#raveshpardakht").css("display", "block");
                value = "1"
            }
        })
        $(".field").on('input', function () {

            var thisval = $(this).val();

            if (thisval.length > 1) {
                $(this).css("border-color", "#b5afaf");

            }
            else {
                $(this).css("border-color", "red");
            }

        })
        var senddata = function () {



            var addressID = $("#addressID").val();
            var counter = 0;
            var payment = $("#payment").val();


            if (addressID == "") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 3000,
                    "extendedTimeOut": 1000
                }
                toastr.error("@Resources.res.addressChoice");
                $("#finalconfirm").click(function () {
                    $("#finalconfirm").off('click');
                    senddata();

                })
                counter = 1;
            }

            if (payment == "" && value == "0") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 3000,
                    "extendedTimeOut": 1000
                }
                toastr.error("@Resources.res.paymentChoice");
                $("#finalconfirm").click(function () {
                    $("#finalconfirm").off('click');
                    senddata();

                })
                counter = 1;
            }
            if (counter == 0) {

                var userPhone = $(".userPhone").text();
                var userFullname = $(".userFullname").text();

                if (userPhone == "" || userFullname == "") {
                    $(".dataError").show();
                }
                else {
                    $("form#endOrderForm").submit();
                }
                

               

            }
        }

        $("#finalconfirm").click(function () {
            $("#finalconfirm").off('click');
            senddata();

        })
    </script>


    @*<script type="text/javascript" src="https://cdn.map.ir/web-sdk/1.4.2/js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places&key=AIzaSyDnIMRNDW6W-9c74yyiO_Sp3oeya0hoLwQ"></script>*@
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places&key=AIzaSyDnIMRNDW6W-9c74yyiO_Sp3oeya0hoLwQ"></script>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin="">
    </script>
    <script type="text/javascript">
                var myMap;
                var theMarker = {};
                var greenIcon;

        function showLocation(position) {

            var lat = position.coords.latitude;
            var lon = position.coords.longitude;



            myMap = L.map('Map', { attributionControl: false }).setView([35.75453394917301, 51.37116999302821], 13);

            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                maxZoom: 18,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

            }).addTo(myMap);
            myMap.panTo(new L.LatLng(lat, lon));

            if ($("#lat").val() != "") {

                lat = $("#lat").val();
                lon = $("#lgn").val()
                theMarker = L.marker([lat, lon]).addTo(myMap);
                myMap.panTo(new L.LatLng(lat, lon));
            };





            myMap.on('click', function (e) {

                $("#checkmap").show();
                lat = e.latlng.lat;
                lon = e.latlng.lng;

                console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                //Clear existing marker,

                if (theMarker != undefined) {
                    myMap.removeLayer(theMarker);
                };

                //Add a marker to show where you clicked.
                theMarker = L.marker([lat, lon]).addTo(myMap);
                $("#lat").val(lat);
                $("#lgn").val(lon);
            });
                theMarker = L.marker([lat, lon]).addTo(myMap);
                $("#lat").val(lat);
                $("#lng").val(lon);






            }
        function errorHandler(err) {

                if (err.code == 1) {
                    //alert("Error: Access is denied!");
                } else if (err.code == 2) {
                    //alert("Error: Position is unavailable!");
                }

            var lat = 35.75453394917301;
            var lon = 51.37116999302821;
                myMap = L.map('Map', { attributionControl: false }).setView([lat, lon], 13);
                L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1,
                    accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

                }).addTo(myMap);

            myMap.panTo(new L.LatLng(lat, lon));

                if ($("#lat").val() != "") {

                    lat = $("#lat").val();
                    lon = $("#lgn").val()
                    theMarker = L.marker([lat, lon]).addTo(myMap);
                    myMap.panTo(new L.LatLng(lat, lon));
                }



                myMap.on('click', function (e) {
                    $("#checkmap").show();
                    lat = e.latlng.lat;
                    lon = e.latlng.lng;

                    console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                    //Clear existing marker,

                    if (theMarker != undefined) {
                        myMap.removeLayer(theMarker);
                    };

                    //Add a marker to show where you clicked.
                    theMarker = L.marker([lat, lon]).addTo(myMap);

                    $("#lat").val(lat);
                    $("#lgn").val(lon);
                });


            }
            function getLocation() {
                if (navigator.geolocation) {
                    // timeout at 60000 milliseconds (60 seconds)
                    var options = { timeout: 60000 };
                    navigator.geolocation.getCurrentPosition
                        (showLocation, errorHandler, options);
                } else {
                    alert("Sorry, browser does not support geolocation!");
                }
        };

        google.maps.event.addDomListener(window, 'load', function () {
            var places = new google.maps.places.Autocomplete(document.getElementById('mapaddress'));
            google.maps.event.addListener(places, 'place_changed', function () {
                var place = places.getPlace();


                if (theMarker != undefined) {
                    myMap.removeLayer(theMarker);
                };
                myMap.panTo(new L.LatLng(place.geometry.location.lat(), place.geometry.location.lng()));
                theMarker = L.marker([place.geometry.location.lat(), place.geometry.location.lng()]).addTo(myMap);
                $("#lat").val(place.geometry.location.lat());
                $("#lng").val(place.geometry.location.lng());
            });
        });
        $("#changeAddress").click(function () {

            $(".addressy").css("display","block")
        })
        $("#cancelAddress").click(function () {
            $("#addAddressHolder").css("display", "none");
            $("body").css("overflow", "scroll")
        })
        $("#addAddress").click(function () {

            $("#addAddressHolder").css("display", "block");
            $("body").css("overflow","hidden")
            getLocation();
            //$("#mapshow").hide();

            //$("#maphide").show();
            //$("#mapshow").hide();

        });
            $("#maphide span").click(function () {
                $("#mapHolder").css("display", "none");

                var lat = $("#lat").val();
                var lon = $("#lgn").val();
                //myMap.panTo(new L.LatLng(lat, lon));
                //$("#maphide").hide();
                //$("#mapshow").show();
                @*if ('@Model.poly' !== '') {

                    $("#loading").fadeIn();

                    $.ajax({
                        url: "/Home/inInArea",
                        data: 'html',
                        data: {
                            lat: $("#lat").val(),
                            log: $("#lgn").val(),
                        },
                        success: function (data) {

                            var deliver = parseInt($("#deliveryprice").text().replace(",", ""));
                            let price = parseInt($("#totalprice").text().replace(",", ""));
                            if (data == "1") {

                                let final = price - deliver;
                                $("#deliveryprice").text("0");
                                $("#totalprice").text(addCommas(final));

                                toastr.options = {
                                    "debug": false,
                                    "positionClass": "toast-top-center",
                                    "onclick": null,
                                    "fadeIn": 300,
                                    "fadeOut": 1000,
                                    "timeOut": 5000,
                                    "extendedTimeOut": 1000
                                }
                                toastr.success("برای موقعیت شما ارسال رایگان است");
                                $("#loading").fadeOut();
                            }
                            else {

                                if (deliver == 0 && price < parseInt('@Model.baseDeliver')) {
                                    $("#deliveryprice").text('@Model.priceDeliver');
                                    $("#totalprice").text(addCommas(price + parseInt('@Model.priceDeliver')));

                                    toastr.options = {
                                        "debug": false,
                                        "positionClass": "toast-top-center",
                                        "onclick": null,
                                        "fadeIn": 300,
                                        "fadeOut": 1000,
                                        "timeOut": 5000,
                                        "extendedTimeOut": 1000
                                    }
                                    toastr.error("برای موقعیت شما ارسال رایگان نمی باشد");
                                }
                                $("#loading").fadeOut();
                            }


                        }
                    });

                }*@


            });

        $("#verifyAddress").click(function () {
            var lat = $("#lat").val();
            var lng = $("#lgn").val();
            var address = $("#modalAddress").val();
            var postalCode = $("#modalpostalCode").val();
            var title = $("#modalTitle").val();
            var city = $("#modalCity").val();
            var state = $("#modalState").val();
            var ID = $("#modalID").val();
            var value = "0";
            if (lat == "0" || lat == "") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 5000,
                    "extendedTimeOut": 1000
                }
                toastr.error("@Resources.res.postionChoice");
                value = "1";
            };
            if (address == "" || postalCode == "" || title == "" || city == "" || state == "") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 5000,
                    "extendedTimeOut": 1000
                }
                toastr.error("@Resources.res.insetAllData");
                value = "1";
            }

            if (value == "0") {
                $.ajax({
                    url: "setAddress",
                    dataType: "html",
                    data: {
                        lat: lat,
                        lng: lng,
                        address: address,
                        postalCode: postalCode,
                        title: title,
                        city: city,
                        state: state,
                        id: ID
                    },
                    success: function (data) {
                        window.location.reload();
                    }
                });
            }


        });

        $(".addressy").click(function () {

            var id = $(this).attr('id');
            $("#addressID").val(id);



            $(".addressy").find('i').css("display", "none")
            $(".addressy").css("display", "none");
            $(this).find('i').css("display", "block");
            $(this).css("display", "block");

        });
        $(".removeAddress").click(function (e) {
            e.stopPropagation();
            $("#removeModal").modal('toggle');
            var sid = $(this).parent().parent().attr('id');
            $("#idToDelete").val(sid);


        });
        $("#removeAddressCancel").click(function () {
            $("#removeModal").modal('toggle');
        })
        $("#removeAddressButt").click(function () {

            var sid = $("#idToDelete").val();
            $.ajax({
                url: "removeAddress",
                dataType: "html",
                data: {
                    id: sid
                },
                success: function (data) {
                    window.location.reload();
                }
            });
        });
        $(".editAddress").click(function (e) {
            $("#addAddressHolder").show()
                    e.stopPropagation();
                    var sid = $(this).parent().parent().attr('id');
                    var addes = @Html.Raw(Json.Encode(Model.address))
                        $.each(addes, function (index, item) {

                            var id = item.ID;
                            if (sid == id) {
                                $("#addressModal").modal('toggle');
                                $("#modalTitle").val(item.title);
                                $("#modalCity").val(item.city);
                                $("#modalState").val(item.state);
                                $("#modalAddress").val(item.address);
                                $("#modalpostalCode").val(item.postalCode);
                                $("#modalID").val(item.ID);

                                var lat = item.lat;
                                var lon = item.lng;

                                $("#lat").val(lat);
                                $("#lgn").val(lon);
                                if (myMap == undefined) {
                                    getLocation();
                                }
                                else {
                                    if (theMarker != undefined) {
                                        myMap.removeLayer(theMarker);
                                    };
                                }


                                //Add a marker to show where you clicked.
                                theMarker = L.marker([lat, lon]).addTo(myMap);
                                myMap.panTo(new L.LatLng(lat, lon));
                            }


                        });

                })

    </script>



}



<style>
    .form__group {
        position: relative;
        padding: 15px 0 0;
        margin-top: 20px;
        width: 80%;
        direction: rtl
    }

    .form__field {
        font-family: inherit;
        width: 100%;
        border: 0;
        border: 2px solid #9b9b9b;
        outline: 0;
        font-size: 1.3rem;
        color: #4d4d4d;
        padding: 7px;
        background: transparent;
        transition: border-color 0.2s;
        border-radius: 8px
    }

        .form__field::placeholder {
            color: transparent;
        }

        .form__field:placeholder-shown ~ .form__label {
            font-size: 0.9rem;
            cursor: text;
            top: 20px;
        }

    .form__label {
        position: absolute;
        top: -10px;
        left: 10px;
        display: block;
        transition: 0.2s;
        font-size: 1rem;
        color: #9b9b9b;
    }

    .form__field:focus {
        padding-bottom: 6px;
        font-weight: 700;
        border-width: 3px;
        border-width: 3px;
        border-color: #7599e9;
        border-radius: 8px;
    }

        .form__field:focus ~ .form__label {
            position: absolute;
            top: -10px;
            left: 10px;
            display: block;
            transition: 0.2s;
            font-size: 1rem;
            color: #4169E1;
            font-weight: 700;
        }

    /* reset input */
    .form__field:required, .form__field:invalid {
        box-shadow: none;
    }

    /* demo */
    .modal-bodyy {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        background-color: #fff;
        width: 80%;
        margin: auto;
        border-radius: 10px
    }

    @@media (max-width: 767px) {
        .form__group {
            position: relative;
            padding: 15px 0 0;
            margin-top: 15px;
            width: 100%;
            direction: rtl;
            font-size: 12px;
        }

        .modal-bodyy {
            width: 100%
        }
    }
</style>
<div class="modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <input id="idToDelete" style="display:none" />
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                @Resources.res.removeConfirm
            </div>
            <div class="modal-footer">
                <button id="removeAddressButt" type="button" class="btn btn-secondary" data-dismiss="modal">@Resources.res.OK</button>
                <button id="removeAddressCancel" type="button" class="btn btn-primary">@Resources.res.cancel</button>
            </div>
        </div>
    </div>
</div>

@{



    userdata user = @Session["LogedInUser"] as userdata;
    string fullname = user.fullname;
    string phone = user.phone;
    string address = user.address;
    string city = user.city;
    string ostan = user.province;


    <p style="display:none" class="userPhone">@phone</p>
    <p style="display:none" class="userFullname">@fullname</p>

    <form id="endOrderForm" name="endOrderForm" action="EndOrder" method="post">
        <p id="error" style="color :red; text-align:center; padding:10px"></p>
        <input hidden name="addID" id="addID" value="0" />
        <input hidden name="disc" id="lon" value="0" />
        <input hidden name="lat" id="lat" value="" />
        <input hidden name="lgn" id="lgn" value="" />
        <input hidden id="addressID" name="addressID" />
        <div id="app" style="width:100%; height:100%"></div>
        <div style="margin:30px 0px 30px 0px"></div>
        <div class="main_container" style="width: 50%; margin: auto">
            <div class="containerofform">
                <div class="header "><p>@Resources.res.addressLable</p></div>
                <div style="display:flex;margin:20px 30px 0 20px;">
                    <p style="margin-left:20px" id="addAddress" class="btn btn-success">@Resources.res.addNewAddress</p>
                    @if (Model.address != null)
                    {
                        if (Model.address.Count() > 1)
                        {
                            <p id="changeAddress" class="btn btn-success">@Resources.res.changeAddress</p>
                        }
                    }

                </div>
                <div class="sectionBody" style="text-align:center">
                    @{
                        if (Model.address != null)
                        {

                            foreach (var item in Model.address)
                            {
                                string display = "none";
                                if (item.active == "1")
                                {
                                    display = "block";

                                    <script>

                                        let latelement = document.getElementById('lat');
                                        let addelement = document.getElementById('addressID');
                                        let lonelement = document.getElementById('lgn');
                                        latelement.value = @item.lat;
                                        lonelement.value = @item.lng;
                                        addelement.value = @item.ID;


                                    </script>
                                }


                                <div id="@item.ID" style="display:@display;  margin: 20px; padding:20px; " class="halfrow addressy">
                                    <i class="fa fa-check " style="display:@display;  margin:0 5px"></i>
                                    <div class="language"  style="text-align:right;font-size:14px; font-weight:600">   @item.title</div><br />
                                    <div class="language" style="text-align:right; font-size:14px"> @Resources.res.address :   @item.address</div>
                                    <div  class="row language" ; style="margin-top:30px; margin-bottom:10px">
                                        <p class="btn btn-default editAddress" style="display:block; margin:-10px 10px">@Resources.res.edit</p>
                                        <p class="btn btn-danger removeAddress" style="display:block; margin: -10px 10px">@Resources.res.remove</p>
                                    </div>
                                </div>
                            }
                        }
                    }
                    <div id="addAddressHolder" style="display:none; position:fixed; top:0; left:0;bottom:0; overflow:scroll; width:100%;z-index:9">
                        <div style="min-height:100%; width:100%; background-color:rgba(0,0,0,0.5)">
                            <div class="modal-bodyy">
                                <div class="row" style="width:100%">
                                    <div class="col-lg-12" style="height:50px"></div>
                                    <div class="col-lg-6">
                                        <div id="mapHolder" style="display:block;  position:relative;top:0; left:0; margin:auto; width:100%; height:500px;  background-color:white; text-align:center; background-color:white;  /* Negative half of width. */">
                                            <div style="height:8%; width:100%;z-index: 9999999999999;height:40px; margin-bottom:10px">
                                                <input type="text" id="mapaddress" style="width:100%; height:100% " class="form-control" />
                                            </div>
                                            <div id="Map" style="border-radius:3px; margin-top:10%; width:100%; margin:auto; height:88%; background: #eee; border: 2px solid #aaa;"></div>

                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <h4 class="language" style="text-align:right; margin-bottom:20px">@Resources.res.addressDetail</h4>
                                        <h5 class="language" style="text-align:right">@Resources.res.plsAddDetailAddress</h5>
                                        <div class="form__group field">
                                            <input type="text" class="form__field" placeholder="@Resources.res.title" name="modalTitle" id='modalTitle' required />
                                            <label for="name" class="form__label">@Resources.res.title</label>
                                        </div>
                                        <div class="form__group field">
                                            <input type="text" class="form__field" placeholder="@Resources.res.ostan" name="modalState" id='modalState' required />
                                            <label for="name" class="form__label">@Resources.res.ostan</label>
                                        </div>
                                        <div class="form__group field">
                                            <input type="text" class="form__field" placeholder="@Resources.res.city" name="modalCity" id='modalCity' required />
                                            <label for="name" class="form__label">@Resources.res.city</label>
                                        </div>
                                        <div class="form__group field">
                                            <input type="text" class="form__field" placeholder="@Resources.res.address" name="modalAddress" id='modalAddress' required />
                                            <label for="name" class="form__label">@Resources.res.address</label>
                                        </div>
                                        <div class="form__group field">
                                            <input type="text" class="form__field" placeholder="@Resources.res.postalCode" name="modalpostalCode" id='modalpostalCode' required />
                                            <label for="name" class="form__label">@Resources.res.postalCode</label>
                                        </div>

                                        <p style="display:none" id="modalID"></p>
                                        <div class="modal-footer" style="border-top:0; margin-top:20px">
                                            <button id="cancelAddress" type="button" class="btn btn-secondary" style="font-size:15px; padding:7px 14px">@Resources.res.cancel</button>
                                            <button id="verifyAddress" type="button" class="btn btn-primary " style="font-size:15px; padding:7px 14px">@Resources.res.OK</button>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>

                    </div>
                    @*<div class="row ">
                    <div class="col-lg-12 col-sm-12 row1 ">
                        <div class="inputdiv1"><p>شهر</p></div>
                        <div class="inputdiv2"><input id="city" name="city" class="form-control field" type="text" value="@city" /></div>
                    </div>


                </div>
                <div class="row ">
                    <div class="col-lg-6 col-sm-6 row1 ">
                        <div class="inputdiv1"><p>نام و نام خانوادگی</p></div>
                        <div class="inputdiv2"><input id="fullname" name="fullname" class="form-control field" type="text" value="@fullname" /></div>
                    </div>
                    <div class="col-lg-6 col-sm-6 row1">
                        <div class="inputdiv1"><p>آدرس</p></div>
                        <div class="inputdiv2"><input id="address" name="address" class="form-control field" type="text" value="@address" /></div>
                    </div>

                </div>
                <div class="row ">
                    <div class="col-lg-6 col-sm-6 row1">
                        <div class="inputdiv1"><p>شماره تلفن</p></div>
                        <div class="inputdiv2"><input id="phonenumber" name="phonenumber" class="form-control field" type="text" value="@phone" /></div>
                    </div>
                    <div class="col-lg-6 col-sm-6 row1 ">
                        <div class="inputdiv1"><p>کد پستی</p></div>
                        <div class="inputdiv2"><input id="postalcode" name="postalcode" class="form-control" type="text" /></div>
                    </div>


                </div>*@
                </div>
            </div>

            @*<div class="containerofform">
            <div class="header"><p> @Resources.res.deliverTime</p></div>
            <div class="sectionBody">
                <div class="row ">
                    @{
                        if (Model.times != null)
                        {

                            foreach (var item in Model.times)
                            {

                                int index = Model.times.IndexOf(item);
                                string checkname = "check" + index;
                                if (index == 0)
                                {
                                    <div class="col-lg-6 col-sm-6 slave" id="@checkname">
                                        @foreach (var detail in item.hours)
                                        {

                                            string finalname = "final" + detail.ID;

                                            <div class="halfrow">
                                                @if (@detail.isChecked == true)
                                                {
                                                    <i class="fa fa-check finalrow" id="@finalname"></i>
                                                }
                                                else
                                                {
                                                    <i class="fa fa-check finalrow" id="@finalname" style="display:none"></i>
                                                }
                                                <p>@detail.title</p>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="col-lg-6 col-sm-6 slave" id="@checkname" style="display:none">
                                        @foreach (var detail in item.hours)
                                        {

                                            string finalname = "final" + detail.ID;

                                            <div class="halfrow ">
                                                @if (@detail.isChecked == true)
                                                {
                                                    <i class="fa fa-check finalrow" id="@finalname"></i>
                                                }
                                                else
                                                {
                                                    <i class="fa fa-check finalrow" id="@finalname" style="display:none"></i>
                                                }
                                                <p>@detail.title</p>
                                            </div>
                                        }
                                    </div>
                                }

                            }

                            <div class="col-lg-6 col-sm-6 Mmaster">
                                @foreach (var item in Model.times)
                                {
                                    int index = Model.times.IndexOf(item);
                                    string checkname = "check" + index;
                                    <div class="halfrow master">
                                        @if (@item.isChecked == true)
                                        {
                                            <i class="fa fa-check dispath" id="@checkname"></i>
                                        }
                                        else
                                        {
                                            <i class="fa fa-check dispath" id="@checkname" style="display:none"></i>
                                        }
                                        <p>@item.title</p>
                                    </div>
                                }
                            </div>

                        }
                    }

                </div>
            </div>
        </div>*@

            @*<div class="containerofform">
            <div class="header"><p> @Resources.res.discountCode</p></div>
            <div class="sectionBody">
                <div class="row ">
                    <div style="padding:7px 15px; width:70%; margin-right : auto; margin-left: auto; border-bottom:2px solid green">
                        <div class="row">
                            <i class="fa fa-pen" style="float:right; width:10%"></i>
                            <input id="discountfake" style="border:none; float:left; width:90%" />
                            <input id="discount" style="display:none; border:none; float:left; width:90%" />

                        </div>
                    </div>
                    <div class="row" style="width:80%; margin:auto;  color:#2585bd">
                        <div style="float:left" id="discountConfirm" class="btn-link-spoiler btn-link-spoiler--edit">
                            @Resources.res.discountSet
                        </div>
                        <script>

                            $('#discountConfirm').click(function () {

                                var mot = $("#finalprice").text().replace(",", '')
                                mot = mot.replace(',', "");
                                var discount = $('#discountfake').val();


                                //alert(discount);
                                if (discount == "") {


                                    toastr.options = {
                                        "debug": false,
                                        "positionClass": "toast-top-center",
                                        "onclick": null,
                                        "fadeIn": 300,
                                        "fadeOut": 1000,
                                        "timeOut": 5000,
                                        "extendedTimeOut": 1000
                                    }
                                    toastr.error("@Resources.res.insertDiscountCode");
                                }
                                else {
                                    $.ajax({
                                        url: '/Home/SetDiscount',
                                        dataType: 'html',
                                        data: {
                                            val: discount,
                                            price: mot
                                        },
                                        success: function (data) {

                                            let obj = jQuery.parseJSON(data);

                                            if (obj.message.length > 0) {

                                                toastr.options = {
                                                    "debug": false,
                                                    "positionClass": "toast-top-center",
                                                    "onclick": null,
                                                    "fadeIn": 300,
                                                    "fadeOut": 1000,
                                                    "timeOut": 5000,
                                                    "extendedTimeOut": 1000
                                                }
                                                toastr.error(obj.message);

                                                // let price = parseInt($("#finalprice").val())

                                            }
                                            else {
                                                $("#discount").val(discount);
                                                var mot = $("#finalprice").text().replace(",", '')
                                                mot = mot.replace(',', "");
                                                var del = $("#deliveryprice").text().replace(",", '')
                                                del = del.replace(',', "");
                                                if (parseInt(mot) - parseInt(obj.price) > 0) {
                                                    toastr.options = {
                                                        "debug": false,
                                                        "positionClass": "toast-top-center",
                                                        "onclick": null,
                                                        "fadeIn": 300,
                                                        "fadeOut": 1000,
                                                        "timeOut": 5000,
                                                        "extendedTimeOut": 1000
                                                    }
                                                    toastr.success("@Resources.res.codeInserted");
                                                    if (parseInt(obj.price) > parseInt(mot)) {
                                                        $("#totalprice").text("0");
                                                    }
                                                    else {

                                                        $("#totalprice").text(addCommas(parseInt(mot) - parseInt(obj.price) + parseInt(del)))

                                                    }

                                                    $("#finalDiscount").text(addCommas(obj.price));
                                                }
                                            }
                                        },
                                        error: function () {

                                        }

                                    })
                                }

                            })
                        </script>
                    </div>

                </div>
            </div>
        </div>*@
            @*<div class="containerofform">
            <div class="header"><p> @Resources.res.finalPrice</p></div>
            <div class="sectionBody">
                <div class="row ">
                    <div id="finalPriceHolder" style="">
                        <div class="row priceitem">
                            @{
                                decimal totalprice = decimal.Parse(Model.finalAmount) + decimal.Parse(Model.priceDeliver);
                            }
                            <p class="col-lg-6 col-sm-6 Holder"> <i id="finalprice">@String.Format("{0:n0}", @Model.finalAmount)</i>&nbsp;@Resources.res.toman</p>
                            <p class="col-lg-6 col-sm-6">@Resources.res.amount</p>
                        </div>
                        <div class="row priceitem">
                            <p class="col-lg-6 col-sm-6 Holder"> <i id="finalDiscount">0</i>&nbsp;@Resources.res.toman</p>
                            <p class="col-lg-6 col-sm-6">@Resources.res.discount</p>
                        </div>
                        <div class="row priceitem">
                            <p class="col-lg-6 col-sm-6 deliveryHolder Holder"><span id="deliveryprice">@String.Format("{0:n0}", @Model.priceDeliver)</span>&nbsp;@Resources.res.toman</p>
                            <p class="col-lg-6 col-sm-6">@Resources.res.deliverPrice</p>
                        </div>
                        <div class="row priceitem">
                            <p class="col-lg-6 col-sm-6 Holder"><span id="totalprice"> @String.Format("{0:n0}", totalprice)  </span>&nbsp;@Resources.res.toman</p>
                            <p class="col-lg-6 col-sm-6">@Resources.res.finalPrice</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>*@

            @*<div class="containerofform">
            <div class="header"><p> @Resources.res.walletUse</p></div>
            <div class="sectionBody">
                <div class="row ">
                    <div id="finalPriceHolder" style="">
                        <div class="row priceitem">
                            <p class="col-lg-6 col-sm-6 Holder"> <i id="finalprice">@Model.credit</i>&nbsp;@Resources.res.toman</p>
                            <p class="col-lg-6 col-sm-6">@Resources.res.balance</p>
                        </div>
                        <style>

                            .switch {
                                position: relative;
                                display: inline-block;
                                width: 60px;
                                height: 34px;
                            }

                                .switch input {
                                    opacity: 0;
                                    width: 0;
                                    height: 0;
                                }

                            .slider {
                                position: absolute;
                                cursor: pointer;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background-color: #ccc;
                                -webkit-transition: .4s;
                                transition: .4s;
                            }

                                .slider:before {
                                    position: absolute;
                                    content: "";
                                    height: 26px;
                                    width: 26px;
                                    left: 4px;
                                    bottom: 4px;
                                    background-color: white;
                                    -webkit-transition: .4s;
                                    transition: .4s;
                                }

                            input:checked + .slider {
                                background-color: #2196F3;
                            }

                            input:focus + .slider {
                                box-shadow: 0 0 1px #2196F3;
                            }

                            input:checked + .slider:before {
                                -webkit-transform: translateX(26px);
                                -ms-transform: translateX(26px);
                                transform: translateX(26px);
                            }

                            /* Rounded sliders */
                            .slider.round {
                                border-radius: 34px;
                            }

                                .slider.round:before {
                                    border-radius: 50%;
                                }
                        </style>
                        <div class="row " style="margin-top:15px; text-align:center">
                            <label id="lableToggle" style="display:inline-block" class="switch">
                                <input type="checkbox">
                                <span class="slider round"></span>
                            </label>
                        </div>

                    </div>
                    <script>
                        $(".switch").click(function () {
                            alet("aaa");
                        })
                    </script>

                </div>
            </div>
        </div>*@
            @*<div class="containerofform" id="raveshpardakht">
            <div class="header"><p>@Resources.res.paymentWay</p></div>
            <div class="sectionBody">
                <div class="row " style="direction:rtl;">


                    @{
                        if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("inplace"))
                        {
                            <div class="col-lg-6 col-sm-6 " id="inplace" style="cursor:pointer; float:right">
                                <div class="halfrow">
                                    <i class="fa fa-check banky" style="display:none"></i>
                                    <p>@Resources.res.inPlacePayment</p>
                                </div>
                            </div>
                        }
                        if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("zarin"))
                        {
                            <div class="col-lg-6 col-sm-6 " id="internet" style="cursor:pointer; float:right">
                                <div class="halfrow">
                                    <i class="fa fa-check banky" style="display:none"></i>
                                    <p>@Resources.res.zarin</p>
                                </div>
                            </div>
                        }

                        if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("mellat"))
                        {
                            <div class="col-lg-6 col-sm-6 " id="mellat" style="cursor:pointer; float:right">
                                <div class="halfrow ">
                                    <i class="fa fa-check banky" style="display:none"></i>
                                    <p>@Resources.res.mellat</p>
                                </div>
                            </div>
                        }
                        if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("pasargad"))
                        {
                            <div class="col-lg-6 col-sm-6 " id="pasargad" style="cursor:pointer; float:right">
                                <div class="halfrow">
                                    <i class="fa fa-check banky" style="display:none"></i>
                                    <p>@Resources.res.pasargad</p>
                                </div>
                            </div>
                        }
                        if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("wallet"))
                        {
                            <div class="col-lg-6 col-sm-6 " id="Wallet" style="cursor:pointer; float:right">
                                    <div class="halfrow">
                                        <i class="fa fa-check banky" style="display:none"></i>

                                        <p>کیف پول</p>
                                    </div>

                                </div>
                        }
                    }

                </div>
            </div>
        </div>*@


            @*<div id="finalconfirm" class="btn-link-spoiler btn-link-spoiler--edit">
            تایید اطلاعات
        </div>*@
            <div class="containerofform">
                <div class="dataError" style="display:none; width:100%; text-align:center; padding:20px">
                    <p style="color:red; font-size:16px">complete your data from <a style="cursor:pointer; font-size:18px; font-weight:600" href="/Home/myprofile?type=1">here</a> first</p>
                </div>
            </div>
          
            <div style="width:100%; text-align:center; padding:20px">
                <div id="finalconfirm" class="btn btn-success" style=" width: 60%;  padding: 10px; font-size: 14px; margin: 0 auto;">
                    @Resources.res.pay
                </div>
            </div>
        </div>
        @{
            var value = "final" + @Model.times[0].hours[0].ID;
            <input hidden id="hourid" name="hourid" value=@value />
            <input hidden id="payment" name="payment" value="2" />

        }
        <div style="margin:30px 0px 30px 0px"></div>
    </form>
}





@if (@ViewBag.error != null)
{
    <script>
            var error = '@ViewBag.error';
            toastr.options = {
                "debug": false,
                "positionClass": "toast-top-center",
                "onclick": null,
                "fadeIn": 300,
                "fadeOut": 1000,
                "timeOut": 5000,
                "extendedTimeOut": 1000
            }
            toastr.error(error);
    </script>
}


